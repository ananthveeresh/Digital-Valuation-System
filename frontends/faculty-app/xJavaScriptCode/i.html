<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Paper Valuation</title>
	<link href="style.css" type="text/css" rel="stylesheet">
	<link href="hover.css" type="text/css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.linearicons.com/free/1.0.0/icon-font.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.16.0/pdf-lib.min.js"></script>
	<script src="https://cdn.linearicons.com/free/1.0.0/svgembedder.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" rel="stylesheet">
  
</head>
<body style="background-color: #e3eaf14d">
<div class="container card">
	 <div class="pt-3">
    <div class="row">
      
      <div class="col-md-5">
          <div class=" d-flex justify-content-between text-primary mb-1">
                <p class="px-2">M. Satya</p>
                <p class="text-danger fw-bold ">
                  <i class="bi bi-clock-fill"></i>
                  <span class="ps-2">00:05:23</span></p>
          </div>

          <div class="btn-group w-100 mb-1" role="group">
            <button  class="btn btn-sm btn-outline-primary"><i class="fa fa-home"></i></button>
            <button id="draw-mode-button" class="btn btn-sm btn-outline-primary"><i class="fa fa-pencil"></i></button>
            <button id="undo-button" class="btn btn-sm btn-outline-primary"><i class="fa fa-undo"></i></button>
            <button id="previous-page-button" class="btn btn-sm btn-outline-primary"><i class="fa fa-chevron-left"></i></button>
            <button class="btn btn-sm btn-outline-primary">01</button>
            <button id="next-page-button" class="btn btn-sm btn-outline-primary"><i class="fa fa-chevron-right"></i></button>
          <div style="position:relative">
              <button style="    border-bottom-left-radius:0;border-top-left-radius: 0;"  class="btn btn-sm btn-primary" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                <i class="fa fa-save"></i>
              </button>
            <div class="collapse colBlock" id="collapseExample" >
            <div class="colBolck_btns_warper">
              <button class="btn btn-sm btn-outline-primary diabled" >1</button>
          <button class="btn btn-sm btn-outline-primary diabled" >2</button>
            <button class="btn btn-sm btn-outline-primary diabled" >3</button>
            <button class="btn btn-sm btn-outline-primary diabled" >4</button>
            <button class="btn btn-sm btn-outline-primary diabled" >5</button>
            <button class="btn btn-sm btn-outline-primary diabled" >6</button>
            <button class="btn btn-sm btn-outline-primary diabled" >7</button>
            <button class="btn btn-sm btn-outline-primary diabled" >8</button>
            <button class="btn btn-sm btn-outline-primary diabled" >9</button>
            <button class="btn btn-sm btn-outline-primary diabled" >10</button>
            <button class="btn btn-sm btn-outline-primary diabled">11</button>
            <button class="btn btn-sm btn-outline-primary diabled" >12</button>
            <button class="btn btn-sm btn-outline-primary diabled" >12</button>
            <button class="btn btn-sm btn-outline-primary diabled" >13</button>
            <button class="btn btn-sm btn-outline-primary diabled" >14</button>
            <button class="btn btn-sm btn-outline-primary diabled" >15</button>
            <button class="btn btn-sm btn-outline-primary diabled" >16</button>
            <button class="btn btn-sm btn-outline-primary diabled" >17</button>
            <button class="btn btn-sm btn-outline-primary diabled" >18</button>
            <button class="btn btn-sm btn-outline-primary diabled" >19</button>
            <button class="btn btn-sm btn-outline-primary diabled" >20</button>
            <button class="btn btn-sm btn-outline-primary diabled" >21</button>
          <button class="btn btn-sm btn-outline-primary diabled" >22</button>
            <button class="btn btn-sm btn-outline-primary diabled" >23</button>
            <button class="btn btn-sm btn-outline-primary diabled" >24</button>
            <button class="btn btn-sm btn-outline-primary diabled" >25</button>
            <button class="btn btn-sm btn-outline-primary diabled" >26</button>
            <button class="btn btn-sm btn-outline-primary diabled" >27</button>
            <button class="btn btn-sm btn-outline-primary diabled" >28</button>
            <button class="btn btn-sm btn-outline-primary diabled" >29</button>
            <button class="btn btn-sm btn-outline-primary diabled" >30</button>
            

            </div>
            <hr>
            <div class="my-2 text-end m-2">
              <button type="submit" class="btn btn-primary btn-sm">submit</button>
            </div>
          </div>
            </div>
          </div>

          
        
    </div>

   
      <div class="col-md-7">

        <div class="btn-group mb-1 w-100 mb-3" role="group">
          <button  class="btn btn-sm btn-primary disabled" style="width: 30px;">Q</button>
          <button  class="btn btn-sm btn-outline-primary diabled" style="width: 30px;">1</button>
          <button  class="btn btn-sm btn-outline-primary diabled" style="width: 30px;">2</button>
          <button  class="btn btn-sm btn-outline-primary diabled" style="width: 30px;">3</button>
          <button  class="btn btn-sm btn-outline-primary diabled" style="width: 30px;">4</button>
          <button  class="btn btn-sm btn-outline-primary diabled" style="width: 30px;">5</button>
          <button  class="btn btn-sm btn-outline-primary diabled" style="width: 30px;">6</button>
          <button  class="btn btn-sm btn-outline-primary diabled" style="width: 30px;">7</button>
          <button  class="btn btn-sm btn-outline-primary diabled" style="width: 30px;">8</button>
          <button  class="btn btn-sm btn-outline-primary diabled" style="width: 30px;">9</button>
          <button  class="btn btn-sm btn-outline-primary diabled" style="width: 30px;">10</button>
        
        </div>
		  
        <div class="btn-group mb-2 w-100 mb-3" role="group">
            <button class="btn btn-sm btn-success disabled">M</button>
			      <button class="btn btn-sm btn-outline-success diabled" style="width: 30px;">0</button>
            <button class="btn btn-sm btn-outline-success diabled" style="width: 30px;">1/2</button>
            <button class="btn btn-sm btn-outline-success diabled" style="width: 30px;">1</button>
            <button class="btn btn-sm btn-outline-success diabled" style="width: 30px;">2</button>
            <button class="btn btn-sm btn-outline-success diabled" style="width: 30px;">3</button>
            <button class="btn btn-sm btn-outline-success diabled" style="width: 30px;">4</button>
            <button class="btn btn-sm btn-outline-success diabled" style="width: 30px;">5</button>
            <button class="btn btn-sm btn-outline-success diabled" style="width: 30px;">6</button>
            <button class="btn btn-sm btn-outline-success diabled" style="width: 30px;">7</button>
            <button class="btn btn-sm btn-outline-success diabled" style="width: 30px;">8</button>
            <button class="btn btn-sm btn-outline-success diabled" style="width: 30px;">9</button>
            <button class="btn btn-sm btn-outline-success diabled" style="width: 30px;">10</button>
        
        </div>
      
      </div>


      </div>
	    </div>  
    
  
      
       
    <div id="pdf-container">
                <canvas id="pdf-canvas"></canvas>
        </div>
     
      
    </div>
  
 

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const url = 'pdfs/1.pdf';
      let pdfDoc = null;
      let pageNum = 1;
      let canvas = document.getElementById('pdf-canvas');
      let ctx = canvas.getContext('2d');
      let isDrawing = false;
      let lastX = 0;
      let lastY = 0;
      let drawingMode = false;
      let annotations = [];

      function resizeCanvas() {
        const container = document.getElementById('pdf-container');
        canvas.width = container.clientWidth;
      }

      window.addEventListener('resize', resizeCanvas);
      resizeCanvas();

      pdfjsLib.getDocument(url).promise.then(function(pdfDoc_) {
        pdfDoc = pdfDoc_;
        renderPage(pageNum);
      });

      function renderPage(num) {
        pdfDoc.getPage(num).then(function(page) {
          let viewport = page.getViewport({ scale: canvas.width / page.getViewport({ scale: 1 }).width });
          canvas.height = viewport.height;

          let renderContext = {
            canvasContext: ctx,
            viewport: viewport
          };

          page.render(renderContext).promise.then(function() {
            redrawAnnotations();
          });
        });
      }

      function redrawAnnotations() {
        pdfDoc.getPage(pageNum).then(function(page) {
          let viewport = page.getViewport({ scale: canvas.width / page.getViewport({ scale: 1 }).width });
          let renderContext = {
            canvasContext: ctx,
            viewport: viewport
          };

          page.render(renderContext).promise.then(function() {
            annotations.forEach(annotation => {
              if (annotation.page === pageNum) {
                ctx.beginPath();
                ctx.moveTo(annotation.startX, annotation.startY);
                ctx.lineTo(annotation.endX, annotation.endY);
                ctx.strokeStyle = "red";
                ctx.lineWidth = 3;
                ctx.stroke();
              }
            });
          });
        });
      }

      function drawMode() {
        drawingMode = !drawingMode;
        document.getElementById('draw-mode-button').innerText = drawingMode ? 'View Mode' : 'Draw Mode';
      }

      function undo() {
        annotations = annotations.filter((annotation, index, array) => {
          if (annotation.page === pageNum && index === array.length - 1) {
            return false;
          }
          return true;
        });
        renderPage(pageNum);
      }

      function nextPage() {
        if (pageNum < pdfDoc.numPages) {
          pageNum++;
          renderPage(pageNum);
        }
      }

      function previousPage() {
        if (pageNum > 1) {
          pageNum--;
          renderPage(pageNum);
        }
      }

      async function savePdf() {
        const existingPdfBytes = await fetch(url).then(res => res.arrayBuffer());
        const pdfDoc = await PDFLib.PDFDocument.load(existingPdfBytes);

        for (let i = 1; i <= pdfDoc.getPageCount(); i++) {
          const page = pdfDoc.getPage(i - 1);
          const { width, height } = page.getSize();
          
          const tempCanvas = document.createElement('canvas');
          tempCanvas.width = width;
          tempCanvas.height = height;
          const tempCtx = tempCanvas.getContext('2d');
          
          annotations.forEach(annotation => {
            if (annotation.page === i) {
              const startX = (annotation.startX / canvas.width) * width;
              const startY = (annotation.startY / canvas.height) * height;
              const endX = (annotation.endX / canvas.width) * width;
              const endY = (annotation.endY / canvas.height) * height;
              
              tempCtx.beginPath();
              tempCtx.moveTo(startX, startY);
              tempCtx.lineTo(endX, endY);
              tempCtx.strokeStyle = "red";
              tempCtx.lineWidth = 3;
              tempCtx.stroke();
            }
          });

          const image = await pdfDoc.embedPng(tempCanvas.toDataURL());
          
          page.drawImage(image, {
            x: 0,
            y: 0,
            width: width,
            height: height
          });
        }

        const pdfBytes = await pdfDoc.save();
        const blob = new Blob([pdfBytes], { type: 'application/pdf' });

        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'annotated.pdf';
        link.click();
      }

      // Mouse drawing events
      canvas.addEventListener('mousedown', (e) => {
        if (drawingMode) {
          isDrawing = true;
          [lastX, lastY] = [e.offsetX, e.offsetY];
        }
      });

      canvas.addEventListener('mousemove', (e) => {
        if (!isDrawing) return;
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(e.offsetX, e.offsetY);
        ctx.strokeStyle = "red";
        ctx.lineWidth = 3;
        ctx.stroke();
        annotations.push({ page: pageNum, startX: lastX, startY: lastY, endX: e.offsetX, endY: e.offsetY });
        [lastX, lastY] = [e.offsetX, e.offsetY];
      });

      canvas.addEventListener('mouseup', () => isDrawing = false);
      canvas.addEventListener('mouseout', () => isDrawing = false);

      // Touch drawing events
      canvas.addEventListener('touchstart', (e) => {
        if (drawingMode) {
          isDrawing = true;
          const touch = e.touches[0];
          const rect = canvas.getBoundingClientRect();
          [lastX, lastY] = [touch.clientX - rect.left, touch.clientY - rect.top];
        }
      });

      canvas.addEventListener('touchmove', (e) => {
        if (!isDrawing) return;
        const touch = e.touches[0];
        const rect = canvas.getBoundingClientRect();
        const [offsetX, offsetY] = [touch.clientX - rect.left, touch.clientY - rect.top];
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(offsetX, offsetY);
        ctx.strokeStyle = "red";
        ctx.lineWidth = 3;
        ctx.stroke();
        annotations.push({ page: pageNum, startX: lastX, startY: lastY, endX: offsetX, endY: offsetY });
        [lastX, lastY] = [offsetX, offsetY];
        e.preventDefault();
      });

      canvas.addEventListener('touchend', () => isDrawing = false);
      canvas.addEventListener('touchcancel', () => isDrawing = false);

      document.getElementById('draw-mode-button').addEventListener('click', drawMode);
      document.getElementById('undo-button').addEventListener('click', undo);
      document.getElementById('next-page-button').addEventListener('click', nextPage);
      document.getElementById('previous-page-button').addEventListener('click', previousPage);
      document.getElementById('save-pdf-button').addEventListener('click', savePdf);
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
